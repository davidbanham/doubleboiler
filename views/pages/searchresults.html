{{ template "base.html" . }}

{{ define "breadcrumbs" }}
{{ template "crumbs" crumbs "Search Results" "#" }}
{{ end }}

{{ define "content" }}
<ul class="text-sm divide-y divide-gray-200">
  <li>
    {{ template "searchbox" dict "Phrase" .Phrase "EntityFilterMap" .EntityFilterMap }}
  </li>
  <li>
    {{ $uniqClass := uniq }}
    <select class="choices-picker {{$uniqClass}}" id="entity-filter" name="entity-filter" multiple>
      {{ range searchableEntities .Context }}
      <option
          value="{{.Label}}"
          {{ if and $.EntityFilterMap .Label}}
          {{ if (index $.EntityFilterMap .Label)}} selected {{ end }}
          {{ end }}
          >{{.Label}}</option>
      {{ end }}
    </select>
    <script>
      (function(){
        const elem = document.getElementsByClassName({{$uniqClass}})[0];
        const instance = new Choices(elem, {});
        instance.passedElement.element.addEventListener(
          'change',
          function(event) {
            const searchParams = new URLSearchParams(window.location.search);
            searchParams.delete('entity-filter');
            instance.getValue(true).forEach(function(val) {
              searchParams.append('entity-filter', val);
            });
            window.location.search = searchParams.toString();
          },
          false,
        );
      })()
    </script>
  </li>

  {{ if eq (len .Results.Data) 0 }}
  {{ template "list-item" dict "URI" "#" "Label" "Sorry, there are no results for that query." }}
  {{ end }}

  {{ range .Results.Data }}
  {{ $path := "" }}
  {{ if .Path }}
  {{ $path := (print "/" .Path "/" .ID) }}
  {{ end }}

  {{ template "list-item" dict "URI" $path "Label" .Label "Secondary" .EntityType }}
  {{ end }}
</ul>
{{ template "pagination" .Results }}

{{ end }}
